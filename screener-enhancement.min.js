function createSectionInfoLabel(){return Object.assign(document.createElement("div"),{textContent:"",style:"text-align: right; font-weight: 500; font-size: 15px; color: #c62828;"})}function getLatestValueFromTable(e,t,n=!1){const o=Array.from(document.querySelectorAll(`${e} table.data-table tbody tr`)).find((e=>e.cells[0].innerText.includes(t)))?.querySelectorAll("td:last-child")?.[0]?.innerText?.split("\n")?.[0];return n?o:o?.replaceAll(/[,|%]/g,"")}function getQuickRatio(e,t=!1){const n=document.querySelectorAll("#top-ratios li");let o=null,r=!0;for(let a=0;a<n.length;++a){const i=n[a];if(i?.getElementsByClassName("name")?.[0]?.innerText===e){o=t?i?.getElementsByClassName("value")?.[0]?.innerText:i?.getElementsByClassName("value")?.[0]?.innerText?.match(/[\d,.]+/)?.[0]?.replace(/,/g,""),r=!1;break}}return{notFound:r,value:t?o:parseFloat(o)||0}}function injectStyles(){if(document.getElementById("growth-popover-style"))return;const e=document.createElement("style");e.id="growth-popover-style",e.textContent="\n    .highlight-popover {\n      outline: 1px solid #ffc107;\n      background: #333 !important;\n      z-index: 10;\n      opacity: 1 !important;\n    }\n  ",document.head.appendChild(e)}function showAlert(e){alert(e)}function getSelectedRows(e,t){return Array.from(e.querySelectorAll("tbody tr")).filter((e=>{const n=e.cells[0]?.textContent.trim();return n&&t.some((e=>n.toLowerCase().startsWith(e.toLowerCase())))}))}function getFormattedHeaderCellText(e){return Array.from(e.childNodes)?.filter((e=>e.nodeType===Node.TEXT_NODE))?.map((e=>e.textContent.trim()))?.join(" ")?.trim()?.toLowerCase()}function transferRowsToCashFlow(e,t,n,o){e.forEach((e=>{const r=o.insertRow(0),a=e.cells[0]?.textContent.trim();r.insertCell().textContent=a,e.querySelectorAll("td").forEach(((e,o)=>{if(o>0){const a=getFormattedHeaderCellText(t[o]);if(-1!==n.indexOf(a)){r.insertCell().textContent=e.textContent.trim()}}}))}))}function createPopover(e,t){const n=document.createElement("div");return n.className="growth-popover",n.textContent=e,Object.assign(n.style,{position:"absolute",background:t>0?"#2e7d32":"#c62828",color:"#fff",fontSize:"12px",padding:"2px 4px",borderRadius:"4px",top:"-10px",right:"2px",pointerEvents:"auto"}),n}function removeExistingPopover(e){const t=e.querySelector(".growth-popover");t&&t.remove()}function addCheckboxesToHeaders(e){e.forEach(((t,n)=>{const o=n===e?.length-1;if(n>0&&!t.querySelector('input[type="checkbox"]')){const e=document.createElement("input");e.type="checkbox",o&&(e.checked=!0),e.style.marginRight="5px",e.style.cursor="pointer",e.style.transform="scale(1.25)",t.prepend(e)}}))}function addSumButton(e,t,n){const o=getContainerButton("Cash Flow Insights");o.addEventListener("click",(()=>sumSelectedColumns(e,t))),n.parentElement.insertBefore(o,n)}function getContainerButton(e){const t=document.createElement("button");return Object.assign(t,{textContent:e}),Object.assign(t.style,{marginBottom:"10px",marginTop:"10px",padding:"8px 12px",background:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",float:"right"}),t}function waitForChild(e,t,n=5e3){return new Promise(((o,r)=>{if(!e)return r(new Error("Parent element not found"));const a=t(e);if(a)return o(a);const i=new MutationObserver((()=>{const n=t(e);n&&(i.disconnect(),clearTimeout(l),o(n))}));i.observe(e,{childList:!0,subtree:!0});const l=setTimeout((()=>{i.disconnect(),r(new Error("Element not found within timeout"))}),n)}))}window.launchScreenerEnhancement=function(){if(window.calculationsApplied)return void alert("Calculations have already been applied.");window.unavailableRatios=[],injectStyles();const e=["Revenue","Sales","Operating Profit","Financing Profit","Net Profit","EPS in Rs"],t=["EPS in Rs"],n=document.getElementById("profit-loss");if(!n)return showAlert('Table with id "profit-loss" not found.');const o=n.querySelectorAll("thead th"),r=getSelectedRows(n,e).reverse(),a=document.getElementById("cash-flow");if(!a)return showAlert('Table with id "cash-flow" not found.');const i=a.querySelectorAll("thead th"),l=Array.from(i).map((e=>e.textContent.trim().toLowerCase())),s=a.querySelector("tbody");transferRowsToCashFlow(r,o,l,s),addGrowthPopovers(r,t),addCheckboxesToHeaders(i),addSumButton(i,s,a);const d=document.getElementById("quarters");if(!d)return showAlert('Table with id "quarters" not found.');const c=getSelectedRows(d,e).reverse(),u=d.textContent?.includes("Half Yearly Results");window.growthMode="yoy",addYoYGrowthPopovers(c,u,t);const{value:p,notFound:m}=getQuickRatio("Pledged percentage");if(m&&window.unavailableRatios.push("Pledged percentage"),document.querySelector("#shareholding")){const e=getLatestValueFromTable("#shareholding","Promoter")??0,t=createSectionInfoLabel(),n=e?(p/100*e).toFixed(2):0;t.textContent=m?"Pledged percentage quick ratio not available!":`Pledged: ${p}% (${n}% / ${e}%)`,document.querySelector("#quarterly-shp")?.parentElement?.insertBefore(t,document.querySelector("#quarterly-shp"))}const{value:h,notFound:g}=getQuickRatio("Cont Liab",!0);g&&window.unavailableRatios.push("Contingent Liabilities");const f=createSectionInfoLabel();f.style.marginRight="24px",document.querySelector("#balance-sheet table")&&(f.textContent=g?"Contingent liabilities quick ratio not available!":`Contingent liabilities: ${h}`,document.querySelector("#balance-sheet table")?.parentElement?.insertBefore(f,document.querySelector("#balance-sheet table")));const v=getContainerButton("qoq"===window.growthMode?"Viewing QoQ":"Viewing YoY");v.addEventListener("click",(()=>{window.growthMode="qoq"===window.growthMode?"yoy":"qoq",v.textContent="qoq"===window.growthMode?"Viewing QoQ":"Viewing YoY","qoq"===window.growthMode?addGrowthPopovers(c,t):addYoYGrowthPopovers(c,u,t)})),d.parentElement.insertBefore(v,d),addMoreRatiosToTable(),createDrawerWithLayoutToggle();const b=parseFloat(getLatestValueFromTable("#profit-loss","Sales")??getLatestValueFromTable("#profit-loss","Revenue")),x=parseFloat(getLatestValueFromTable("#profit-loss","OPM %")??getLatestValueFromTable("#profit-loss","Financing Margin %")),y=parseFloat(getLatestValueFromTable("#profit-loss","Depreciation"))+parseFloat(getLatestValueFromTable("#profit-loss","Interest")),w=getLatestValueFromTable("#balance-sheet","Equity Capital"),C=getLatestValueFromTable("#balance-sheet","Reserves"),E=parseFloat(w)+parseFloat(C),{value:F}=getQuickRatio("Market Cap"),{value:B}=getQuickRatio("Stock P/E"),{value:T,notFound:$}=getQuickRatio("Enterprise Value"),{value:I,notFound:A}=getQuickRatio("EVEBITDA");$&&window.unavailableRatios.push("Enterprise Value"),A&&window.unavailableRatios.push("EV/EBITDA");const M=getContainerButton("Financial modelling");M.addEventListener("click",(()=>{showFinancialModelModal(b,F,x,E,T,y,B,I)})),n.parentElement.insertBefore(M,n),window.calculationsApplied=!0,window.unavailableRatios.length&&createModal({title:"Missing Quick Ratios",content:`<div style="color: #c62828; font-size: 16px; margin-top: 16px;">\n      <ul>\n        ${window.unavailableRatios.map((e=>`<li>${e}</li>`)).join("")}\n      </ul>\n      </div>`,isHTML:!0})};const getTableCellWithText=(e,t,n)=>Array.from(e.querySelectorAll(t)).find((e=>e.textContent.includes(n))),expandCellAndWaitForContent=async(e,t,n)=>{const o="td:nth-child(1)",r=document.querySelector(e);if(!getTableCellWithText(r,o,n)){const e=getTableCellWithText(r,o,t);e?.querySelector("button").click(),await waitForChild(r,(e=>getTableCellWithText(e,o,n)),2e3).catch(console.error)}};async function sumSelectedColumns(e,t){const n=[],o=[];if(e.forEach(((e,t)=>{if(t>0){const r=e.querySelector('input[type="checkbox"]');r?.checked&&(n.push(t),o.push(e.textContent.trim()))}})),0===n.length)return showAlert("No headers selected!");await expandCellAndWaitForContent("#cash-flow","Cash from Operating Activity","Receivables"),await expandCellAndWaitForContent("#cash-flow","Cash from Investing Activity","Fixed assets purchased");const r=["Sales","Revenue","Operating Profit","Financing Profit","Net Profit","Receivables","Payables","Inventory","Other WC items","Cash from Operating Activity","Fixed assets purchased","Fixed assets sold"],a=[];if(t.querySelectorAll("tr").forEach((e=>{const t=e.cells[0]?.textContent.trim()?.replace(/[+-]/g,"");if(r.some((e=>t.toLowerCase().startsWith(e.toLowerCase())))){const o=n.reduce(((t,n)=>{const o=parseFloat(e.cells[n]?.textContent.replace(/[^0-9.-]+/g,"")||"0");return isNaN(o)?t:t+o}),0);a.push({label:t,total:o.toFixed(2)})}})),0===a.length)return showAlert("No matching rows found.");a.sort(((e,t)=>r.findIndex((t=>e.label.toLowerCase().startsWith(t.toLowerCase())))-r.findIndex((e=>t.label.toLowerCase().startsWith(e.toLowerCase())))));const i=a.find((e=>e.label.startsWith("Operating Profit")))||a.find((e=>e.label.startsWith("Financing Profit"))),l=a.find((e=>e.label.startsWith("Net Profit"))),s=a.find((e=>e.label.startsWith("Cash from Operating Activity"))),d=a.find((e=>e.label.startsWith("Fixed assets purchased"))),c=a.find((e=>e.label.startsWith("Fixed assets sold")));d&&(a.push({label:"Net Fixed assets purchased",total:(parseFloat(d?.total??0)+parseFloat(c?.total??0))?.toFixed(2)}),a.push({label:"Free cash flow",total:(parseFloat(s.total)+parseFloat(d?.total??0)+parseFloat(c?.total??0))?.toFixed(2)})),s&&l&&a.push({label:"CFO/PAT",total:(s.total/l.total*100)?.toFixed(2)+" %"}),s&&i&&a.push({label:"CFO/EBITDA",total:(s.total/i.total*100).toFixed(2)+" %"});const u=["Fixed assets purchased","Fixed assets sold"],p=`<div style="margin-bottom: 32px">${o.join(", ")}</div>`,m=a?.filter((e=>!u.some((t=>e.label.startsWith(t))))).map(((e,t)=>{const n=e.label?.startsWith("Cash from Operating Activity")||e.label?.startsWith("Net Profit");return`\n        <div style="font-weight: ${n?"600":""}; padding: 8px 4px; background: ${t%2==0?"rgb(248,248,255)":""}">${e.label}</div>\n        <div style="font-weight: ${n?"600":""}; text-align: right; padding: 8px 4px; background: ${t%2==0?"rgb(248,248,255)":""}">${e.total}</div>\n      `})).join("");createModal({title:"Cash flow insights",content:p+`<div style="display: grid; grid-template-columns: 1fr auto;">${m}</div>`,isHTML:!0})}function createModal({title:e="Modal Title",content:t="",isHTML:n=!1,maxWidth:o="400px"}){const r=document.createElement("div");Object.assign(r.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const a=document.createElement("div");Object.assign(a.style,{backgroundColor:"#fff",padding:"20px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)",maxWidth:o,width:"100%",position:"relative"});const i=document.createElement("h3");i.textContent=e;const l=document.createElement("div");n?l.innerHTML=t:l.textContent=t;const s=document.createElement("button");return s.textContent="×",Object.assign(s.style,{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"32px",cursor:"pointer"}),s.onclick=()=>document.body.removeChild(r),a.append(s,i,l),r.appendChild(a),document.body.appendChild(r),r}function addGrowthPopovers(e,t){clearPopovers(e),e.forEach((e=>{const n=Array.from(e.cells).map((e=>parseFloat(e.textContent.replace(/[^0-9.-]+/g,"")))),o=t.some((t=>e.cells?.[0]?.textContent?.trim()?.startsWith(t)));for(let t=2;t<n.length;t++){const r=n[t-1],a=n[t];if(isNaN(r)||isNaN(a))continue;const i=(a-r)/Math.abs(r||1)*100,l=e.cells[t];if(removeExistingPopover(l),l.style.position="relative",o)l.setAttribute("data-tooltip",`${i.toFixed(2)}%`);else{const e=createPopover(`${i.toFixed(2)}%`,i);l.appendChild(e)}}}))}function highlightPopover(e,t){const n=document.getElementById(e);n&&n.classList.toggle("highlight-popover",t)}function addYoYGrowthPopovers(e,t,n){clearPopovers(e);const o=t?3:5,r=t?2:4;e.forEach(((e,t)=>{const a=Array.from(e.cells).map((e=>parseFloat(e.textContent.replace(/[^0-9.-]+/g,"")))),i=n.some((t=>e.cells?.[0]?.textContent?.trim()?.startsWith(t)));for(let n=1;n<a.length;n++){const l=n-r,s=a[n],d=a[l],c=e.cells[n];removeExistingPopover(c),c.style.position="relative";const u=`popover-${t}-${n}`,p=`popover-${t}-${l}`;if(i&&n>=o&&!isNaN(d)&&!isNaN(s)){const e=(s-d)/Math.abs(d||1)*100;c.setAttribute("data-tooltip",`${e.toFixed(2)}%`);continue}let m;if(n<o||isNaN(d)||isNaN(s))m=createPopover("",0),m.style.opacity="0",m.style.width="18px",m.style.height="13px",m.style.pointerEvents="none";else{const e=(s-d)/Math.abs(d||1)*100;m=createPopover(`${e.toFixed(2)}%`,e),m.addEventListener("mouseenter",(()=>{highlightPopover(u,!0),highlightPopover(p,!0)})),m.addEventListener("mouseleave",(()=>{highlightPopover(u,!1),highlightPopover(p,!1)}))}m.id=u,c.appendChild(m)}}))}function clearPopovers(e){e.forEach((e=>{Array.from(e.cells).forEach((e=>{e.querySelectorAll(".growth-popover").forEach((e=>e.remove()))}))}))}async function addMoreRatiosToTable(){await expandCellAndWaitForContent("#balance-sheet","Other Assets","Trade receivables");const e=document.querySelector("#balance-sheet"),t=document.querySelector("#ratios"),n=document.querySelector("#profit-loss"),o=document.querySelector("#cash-flow");if(!e||!t)return void console.error("Sections not found!");const r=S(e),a=S(t),i=S(n),l=S(o),s=P("Borrowing",e),d=P("Equity Capital",e),c=P("Reserves",e),u=P("Trade receivables",e),p=P("Sales",n),m=P("Net Profit",n),h=P("Profit before tax",n),g=P("Interest",n),f=p?.length?p:P("Revenue",n),v=P("Operating Profit",n),b=P("Cash Equivalents",e),x=P("Tax %",n),y=P("Cash from Operating Activity",o);if(!(s.length&&d.length&&c.length))return void console.error("Required rows not found or empty!");const w=L(i,f),C=L(r,u),E=function(e,t,n,o){const r={};return e.slice(1).forEach(((e,a)=>{const i=t[a],l=(n[a]??0)+(o[a]??0);r[e]={ratioValue:l&&null!=i?(i/l).toFixed(2):null,numerator:i,denominator:l}})),r}(r,s,d,c),F=function(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=t[r],i=n[e]??0;o[e]={ratioValue:i?(a/i).toFixed(2):0===a?"0.00":null,numerator:a,denominator:i}})),o}(r,u,w),B=function(e,t,n){const o={};return e.slice(1).forEach((e=>{const r=t[e]??0,a=n[e]??0;o[e]=`${r.toFixed(0)}% / ${a.toFixed(0)}%`})),o}(r,k(r,C),k(i,w)),T=function(e,t,n,o,r,a,i){const l={};return e.slice(1).forEach(((e,s)=>{const d=(t[s]??0)+(n[s]??0)+(o[s]??0)-(r[s]??0),c=(a[s]??0)*(1-(i?.[s]??0)/100);if(0===d||isNaN(d))return void(l[e]={ratioValue:"-",numerator:null,denominator:null});const u=c/d*100;l[e]={ratioValue:u?.toFixed(1)+"%",numerator:parseFloat(c?.toFixed(1)),denominator:parseFloat(d?.toFixed(1))}})),l}(r,d,c,s,b,v,x),$=function(e,t,n,o,r,a,i){const l={},s=[],d=[];return e.slice(1).forEach(((e,l)=>{const c=(t[l]??0)+(n[l]??0)+(o[l]??0)-(r[l]??0),u=(a[l]??0)*(1-(i?.[l]??0)/100);s.push(u),d.push(c)})),e.slice(1).forEach(((e,t)=>{if(0===t||!isFinite(d[t])||!isFinite(d[t-1]))return void(l[e]={ratioValue:"-",numerator:null,denominator:null});const n=s[t]-s[t-1],o=d[t]-d[t-1];if(0===o||!isFinite(o))return void(l[e]={ratioValue:"-",numerator:null,denominator:null});const r=n/o*100;l[e]={ratioValue:r.toFixed(1)+"%",numerator:parseFloat(n.toFixed(1)),denominator:parseFloat(o.toFixed(1))}})),l}(r,d,c,s,b,v,x),I=function(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=n[r],i=(t[r]??0)+(a??0);o[e]={ratioValue:i?(i/a).toFixed(2):0===a?"0.00":null,numerator:i,denominator:a}})),o}(i,h,g),A=q(l,y,m),M=q(l,y,v),R=t.querySelector("tbody");if(!W(R,"ROE")){const e=function(e,t,n,o){const r={};return e.slice(1).forEach(((e,a)=>{const i=(t[a]??0)+(n[a]??0),l=0!==i?(o?.[a]??0)/i*100:0;r[e]=`${l.toFixed(1)}%`})),r}(r,d,c,m);V(R,a,"ROE",e)}if(!W(R,"ROCE")){const e=function(e,t,n,o,r,a){const i={};return e.slice(1).forEach(((e,l)=>{const s=(t[l]??0)+(n[l]??0),d=o[l]??0,c=(t[l-1]??null)+(n[l-1]??null),u=o[l-1]??null;if(!(null!=t[l-1]||null!=n[l-1]||null!=o[l-1]))return void(i[e]="-");const p=(s+d+c+u)/2,m=r[l]??0,h=a[l]??0,g=0!==p?(m+h)/p*100:0;i[e]=g.toFixed(1)+"%"})),i}(r,d,c,s,h,g);V(R,a,"ROCE",e)}function S(e){return Array.from(e.querySelectorAll("thead th")).map((e=>e.innerText.trim())).filter((e=>!e.includes("(")))}function P(e,t){const n=t.querySelectorAll("tbody tr");for(let t of n){const n=t.querySelector("td.text")?.innerText?.trim();if(n?.startsWith(e))return Array.from(t.querySelectorAll("td:not(.text)")).map((e=>{const t=parseFloat(e.innerText.replace(/[,|%]/g,""));return isNaN(t)?null:t}))}return[]}function L(e,t){const n={};return e.slice(1).forEach(((e,o)=>{n[e]=t?.[o]??0})),n}function q(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=t[r]??0,i=n[r]??0,l=0!==i?(a/i*100).toFixed(2)+"%":"-";o[e]={ratioValue:l,numerator:a,denominator:i}})),o}function k(e,t){const n={};let o=null;return e.slice(1).forEach((e=>{const r=t[e];if(null!=o&&null!=r&&0!==o){let t=(r-o)/Math.abs(o)*100;isFinite(t)&&!isNaN(t)||(t=0),n[e]=t}else n[e]=0;o=r})),n}function N(e,t,n,o,r,a=!0){const i=document.createElement("tr");i.className=a?"stripe":"";const l=document.createElement("td");l.className="text",l.innerText=n,i.appendChild(l),t.slice(1).forEach((e=>{const t=document.createElement("td"),n=o[e],a=n?.ratioValue,l=n?.numerator,s=n?.denominator;let d="-",c="";null!==a&&(d=a,c=null!=l&&null!=s?`${r}: ${l?.toFixed(2)}/${s?.toFixed(2)}`:""),c?t.setAttribute("data-tooltip",c):t.removeAttribute("data-tooltip"),t.innerText=d,i.appendChild(t)})),e.appendChild(i)}function V(e,t,n,o,r=!0){const a=document.createElement("tr");a.className=r?"stripe":"";const i=document.createElement("td");i.className="text",i.innerText=n,a.appendChild(i),t.slice(1).forEach((e=>{const t=document.createElement("td");t.innerText=o[e]??"-",a.appendChild(t)})),e.appendChild(a)}function W(e,t){return Array.from(e.querySelectorAll("tr")).some((e=>e.querySelector("td.text")?.innerText.trim()?.startsWith(t)))}N(R,a,"Debt to Equity",E,"D/E"),N(R,a,"Interest coverage",I,"IC"),N(R,a,"Receivables to Sales",F,"R/S",!1),V(R,a,"Receivables / Sales Growth",B,!1),N(R,a,"ROIC",T,"ROIC"),N(R,a,"ROIIC",$,"ROIIC"),N(R,a,"CFO/PAT",A,"CFO/PAT %",!1),N(R,a,"CFO/EBITDA",M,"CFO/EBITDA %",!1)}function createDrawerWithLayoutToggle(){window.setDrawerContent=function(e){const t=document.querySelector("#drawer-content");t&&("string"==typeof e?t.innerHTML+=e:e instanceof HTMLElement&&t.appendChild(e))};let e=!1;const t=document.createElement("div");t.id="drawer";const n=document.createElement("div");n.id="drawer-handle",n.innerText="≡";const o=document.createElement("div");o.id="drawer-content",o.style.overflowY="auto",o.style.maxHeight="100vh";const r=document.createElement("button");r.id="layout-toggle-btn",r.textContent="Fix",r.style.fontWeight="normal",r.style.height="32px",r.style.padding="4px",r.addEventListener("click",(()=>{const e=t.classList.toggle("expanded");i.classList.toggle("shifted",e)}));const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="space-between",a.innerHTML='<h2 style="margin-top: 0;">Financials checklist</h2>',a.appendChild(r),o.innerHTML="",o.appendChild(a),t.appendChild(n),t.appendChild(o);const i=document.createElement("div");for(i.id="page-wrapper";document.body.firstChild;)i.appendChild(document.body.firstChild);document.body.appendChild(t),document.body.appendChild(i);const l=document.createElement("style");l.textContent="\n        body {\n          margin: 0;\n          padding: 0;\n        }\n    \n        #drawer {\n          position: fixed;\n          top: 0;\n          left: -20%;\n          width: 20%;\n          height: 100%;\n          background: white;\n          box-shadow: 2px 0 4px rgba(0,0,0,0.2);\n          transition: left 0.3s ease, width 0.3s ease;\n          z-index: 9999;\n          font-family: sans-serif;\n        }\n    \n        #drawer.open {\n          left: 0;\n        }\n    \n        #drawer.expanded {\n          width: 20%;\n        }\n    \n        #drawer-handle {\n          position: absolute;\n          right: -30px;\n          top: 50%;\n          transform: translateY(-50%);\n          width: 30px;\n          height: 60px;\n          background: white;\n          font-size: 20px;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 0 5px 5px 0;\n          box-shadow: 3px 0 4px rgba(0,0,0,0.2);\n        }\n    \n        #drawer-content {\n          padding: 20px;\n        }\n    \n        #page-wrapper {\n          transition: margin-left 0.3s ease, width 0.3s ease;\n        }\n    \n        #page-wrapper.shifted {\n          margin-left: 20%;\n          width: 80%;\n        }\n      ",document.head.appendChild(l),n.addEventListener("click",(()=>{const n=!t.classList.contains("open");var o;(t.classList.toggle("open"),window.guideInfoLoaded)||(n?(o="https://cdn.jsdelivr.net/gh/gitdev-common/utils@1.0.11/screener-guide.js",new Promise(((t,n)=>{if(e)return t();const r=document.createElement("script");r.src=o,r.onload=()=>{e=!0,t()},r.onerror=n,document.head.appendChild(r)}))).then((()=>{window.guideInfoLoaded=!0})).catch((e=>{console.error("Failed to load drawer script:",e)})):(t.classList.remove("expanded"),i.classList.remove("shifted")))}))}function showFinancialModelModal(e,t,n,o,r=0,a=30,i=20,l=15){function s(e,t){const n=e/100;return Math.pow(1+n,t)}createModal({title:"Financial Modelling (Bull / Base / Bear)",content:getFinancialModelHTML(e,t,o,r),isHTML:!0,maxWidth:"1200px"}),setTimeout((()=>{const e=document.getElementById("valuation-method"),t=document.getElementById("scenario-table");function o(e){const o=["Bull","Base","Bear"].map((t=>{const o="Bull"===t?25:"Base"===t?20:15,r="Base"===t?n:"Bull"===t?n+2:n-2,s="Base"===t?a:"Bull"===t?(.9*a).toFixed(1):(1.1*a).toFixed(1),d="Base"===t?parseInt(i):"Bull"===t?parseInt(1.2*i):parseInt(.8*i),c="Base"===t?parseInt(l):"Bull"===t?parseInt(1.2*l):parseInt(.8*l),u='<svg\n                xmlns="http://www.w3.org/2000/svg"\n                width="16"\n                height="16"\n                fill="currentColor"\n                viewBox="0 0 16 16">\n                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zM4 2.5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zM4.5 6.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V7a.5.5 0 0 0-.5-.5h-1zM7.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-1zM10.5 6.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z" />\n              </svg>';return"pe"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                    <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-rev" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-rev',\n                          document.getElementById('rev').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                  </td>\n                  <td><input type="number" id="${t}-ebitda" value="${r}"></td>\n                  <td><input type="number" id="${t}-other" value="${s}"></td>\n                  <td><input type="number" id="${t}-tax" value="26"></td>\n                  <td><input type="number" id="${t}-pe" value="${d}"></td>\n                </tr>`:"ev_ebitda"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                  <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-rev" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-rev',\n                          document.getElementById('rev').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                    </td>\n                  <td><input type="number" id="${t}-ebitda" value="${r}"></td>\n                  <td><input type="number" id="${t}-evEbitda" value="${c}"></td>\n                </tr>`:"pb"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                  <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-networthGrowth" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-networthGrowth',\n                          document.getElementById('networth').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                  </td>\n                  <td><input type="number" id="${t}-pb" value="${"Bull"===t?6:"Base"===t?4:2}"></td>\n                </tr>`:null})).join("");let r="";r="pe"===e?"\n            <tr>\n              <th>Scenario</th>\n              <th>Rev CAGR %</th>\n              <th>EBITDA Margin %</th>\n              <th>Other Costs</th>\n              <th>Tax Rate %</th>\n              <th>Exit PE</th>\n            </tr>":"ev_ebitda"===e?"\n            <tr>\n              <th>Scenario</th>\n              <th>Rev CAGR %</th>\n              <th>EBITDA Margin %</th>\n              <th>Exit EV / EBITDA</th>\n            </tr>":"\n            <tr>\n              <th>Scenario</th>\n              <th>Net Worth CAGR %</th>\n              <th>Exit P/B</th>\n            </tr>",t.innerHTML=`\n          <table>\n            <thead>${r}</thead>\n            <tbody>${o}</tbody>\n          </table>\n        `}o("pe"),e.addEventListener("change",(()=>{o(e.value),document.getElementById("results").innerHTML=""})),document.getElementById("calculate-btn")?.addEventListener("click",(()=>{const e=parseFloat(document.getElementById("rev").value),t=parseFloat(document.getElementById("mcap").value),n=parseInt(document.getElementById("years").value),o=parseFloat(document.getElementById("enterpriseValue").value||0),r=document.getElementById("networth").value,a=document.getElementById("valuation-method").value,i=parseFloat(document.getElementById("qip").value||0),l=t+i,d=o+i,c=[];for(const t of["Bull","Base","Bear"]){let o=0;if("pe"===a){const r=parseFloat(document.getElementById(`${t}-rev`).value)/100,a=parseFloat(document.getElementById(`${t}-ebitda`).value)/100,i=parseFloat(document.getElementById(`${t}-other`).value),d=parseFloat(document.getElementById(`${t}-tax`).value)/100,u=parseFloat(document.getElementById(`${t}-pe`).value),p=e*Math.pow(1+r,n),m=(p*a-i)*(1-d);o=m*u;const h=100*(Math.pow(o/l,1/n)-1),g=(l/m).toFixed(1);c.push({scenario:t,futureRevenue:p.toFixed(0),futurePAT:m.toFixed(0),futureMCap:o.toFixed(0),cagr:`${h.toFixed(2)} % (${s(h,n).toFixed(1)}x)`,forwardMultiple:g})}else if("ev_ebitda"===a){const r=parseFloat(document.getElementById(`${t}-rev`).value)/100,a=parseFloat(document.getElementById(`${t}-ebitda`).value)/100,i=parseFloat(document.getElementById(`${t}-evEbitda`).value),l=e*Math.pow(1+r,n),u=l*a;o=u*i;const p=100*(Math.pow(o/d,1/n)-1),m=(d/u).toFixed(1);c.push({scenario:t,futureRevenue:l.toFixed(0),futureEBITDA:u.toFixed(0),futureMCap:o.toFixed(0),cagr:`${p.toFixed(2)} % (${s(p,n).toFixed(1)}x)`,forwardMultiple:m})}else if("pb"===a){const e=parseFloat(document.getElementById(`${t}-networthGrowth`).value)/100,a=parseFloat(document.getElementById(`${t}-pb`).value),d=r*Math.pow(1+e,n)+i;o=d*a;const u=100*(Math.pow(o/l,1/n)-1),p=(l/d).toFixed(1);c.push({scenario:t,futureNetWorth:d.toFixed(0),futureMCap:o.toFixed(0),cagr:`${u.toFixed(2)} % (${s(u,n).toFixed(1)}x)`,forwardMultiple:p})}}const u="pe"===a?["Future Revenue","Future PAT (Fwd PE)","Future MCap"]:"ev_ebitda"===a?["Future Revenue","Future EBITDA (Fwd EV/EBITDA)","Future EV"]:["Future Net Worth (Fwd PB)","Future MCap"];document.getElementById("results").innerHTML=`\n          <h4>Results</h4>\n          <table style="width:100%; border-collapse: collapse; font-size: 1.4rem; margin-top: 1rem">\n            <thead>\n              <tr>\n                <th>Scenario</th>\n                ${u.map((e=>`<th>${e}</th>`)).join("")}\n                <th>Expected CAGR</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${c.map((e=>`\n                  <tr>\n                    <td>${e.scenario}</td>\n                    ${u.map((t=>t.includes("Revenue")?`<td>${e.futureRevenue}</td>`:t.includes("PAT")?`<td>${e.futurePAT} (Fwd: ${e.forwardMultiple})</td>`:t.includes("EBITDA")?`<td>${e.futureEBITDA} (Fwd: ${e.forwardMultiple})</td>`:t.includes("Net Worth")?`<td>${e.futureNetWorth} (Fwd: ${e.forwardMultiple})</td>`:"")).join("")}\n                    <td>${e.futureMCap}</td>\n                    <td>${e.cagr}</td>\n                  </tr>`)).join("")}\n            </tbody>\n          </table>`}))}),0)}function getFinancialModelHTML(e,t,n=0,o=0){return`\n      <div class="financial-model-content">\n        <style>\n          .financial-model-content .input-group {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 1rem;\n            margin-bottom: 2rem;\n            margin-top: 3rem;\n          }\n          .financial-model-content .input-group > div {\n            flex: 1;\n            min-width: 150px;\n          }\n          .financial-model-content input,\n          .financial-model-content select {\n            width: 100%;\n            padding: 0.4rem;\n            font-size: 1.5rem;\n            height: 34px;\n          }\n          .financial-model-content label {\n            font-size: 1.5rem;\n            display: block;\n            margin-bottom: 0.3rem;\n          }\n          .financial-model-content table,\n          .financial-model-content th,\n          .financial-model-content td {\n            border: 1px solid #ccc;\n            padding: 8px;\n            text-align: center;\n          }\n          .financial-model-content th {\n            background-color: #f0f0f5;\n          }\n          .financial-model-content table {\n            width: 100%;\n            border-collapse: collapse;\n          }\n          .financial-model-content #calculate-btn {\n            margin-top: 1rem;\n            padding: 0.6rem 1.2rem;\n            background-color: rgb(25, 118, 210);\n            color: white;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n            border-radius: 4px;\n          }\n        </style>\n\n        <div class="input-group">\n          <div>\n            <label>Current MCap:</label>\n            <input type="number" id="mcap" value="${t}">\n          </div>\n          <div>\n            <label>Current EV:</label>\n            <input type="number" id="enterpriseValue" value="${o}">\n          </div>\n          <div>\n            <label>Current Net Worth:</label>\n            <input type="number" id="networth" value="${n}">\n          </div>\n          <div>\n            <label>Current Revenue:</label>\n            <input type="number" id="rev" value="${e}">\n          </div>\n          <div>\n            <label>QIP (If any):</label>\n            <input type="number" id="qip" value="0">\n          </div>\n          <div>\n            <label>Years:</label>\n            <input type="number" id="years" value="3">\n          </div>\n          <div>\n            <label>Valuation Method:</label>\n            <select id="valuation-method">\n              <option value="pe">P/E</option>\n              <option value="ev_ebitda">EV/EBITDA</option>\n              <option value="pb">P/B</option>\n            </select>\n          </div>\n        </div>\n\n        <div id="scenario-table"></div>\n\n        <div style="text-align:right">\n          <button id="calculate-btn">Calculate</button>\n        </div>\n        <div id="results"></div>\n      </div>\n    `}function openCAGRCalculator(e,t,n){const o=createModal({title:"CAGR Calculator",content:`\n      <style>\n        #cagr-popup-content {\n          font-size: 1.4rem;\n        }\n        #cagr-popup-content label {\n          display: block;\n          margin-bottom: 1rem;\n        }\n        #cagr-popup-content input {\n          width: 100%;\n          padding: 0.5rem;\n          font-size: 1.4rem;\n          box-sizing: border-box;\n        }\n        #cagr-popup-content .button-row {\n          display: flex;\n          justify-content: flex-end;\n          gap: 1rem;\n          margin-top: 1rem;\n        }\n        #cagr-popup-content button {\n          padding: 0.6rem 1.2rem;\n          font-size: 1.4rem;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n        }\n        #calc-cagr-btn {\n          background-color: #1976d2;\n          color: white;\n        }\n        #close-cagr-btn {\n          background-color: #e0e0e0;\n          color: black;\n        }\n        #cagr-popup-content .error {\n          color: red;\n          font-size: 1.3rem;\n          margin-top: 0.5rem;\n        }\n        #cagr-popup-content .result {\n          margin-top: 1rem;\n          font-weight: bold;\n          font-size: 1.4rem;\n        }\n      </style>\n      <div id="cagr-popup-content">\n        <label>\n          Start Value:\n          <input type="number" id="cagr-start" value="${t}" />\n        </label>\n        <label>\n          End Value:\n          <input type="number" id="cagr-end" />\n        </label>\n        <label>\n          Years:\n          <input type="number" id="cagr-years" value="${n}" />\n        </label>\n\n        <div class="button-row" style="margin-top: 24px;">\n          <button id="close-cagr-btn">Close</button>\n          <button id="calc-cagr-btn">Calculate</button>\n        </div>\n\n        <p id="cagr-error" class="error"></p>\n        <p id="cagr-result" class="result"> </p>\n      </div>\n    `,isHTML:!0,onClose:()=>{}});setTimeout((()=>{document.getElementById("calc-cagr-btn").onclick=()=>{const t=parseFloat(document.getElementById("cagr-start").value),n=parseFloat(document.getElementById("cagr-end").value),o=parseFloat(document.getElementById("cagr-years").value),r=document.getElementById("cagr-error"),a=document.getElementById("cagr-result");if(r.textContent="",a.textContent="",!t||!n||!o||t<=0||o<=0)return void(r.textContent="Please enter valid positive numbers.");const i=100*(Math.pow(n/t,1/o)-1);a.textContent=`CAGR: ${i.toFixed(2)}%`;const l=document.getElementById(e);l&&(l.value=i.toFixed(2))},document.getElementById("close-cagr-btn").onclick=()=>{document.body.removeChild(o)}}),0)}
