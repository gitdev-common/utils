function createSectionInfoLabel(){return Object.assign(document.createElement("div"),{textContent:"",style:"text-align: right; font-weight: 500; font-size: 15px; color: #c62828;"})}function getLatestValueFromTable(e,t,n=!1){const o=Array.from(document.querySelectorAll(`${e} table.data-table tbody tr`)).find((e=>e.cells[0].innerText.includes(t)))?.querySelectorAll("td:last-child")[0]?.innerText?.split("\n")?.[0];return n?o:o?.replaceAll(/[,|%]/g,"")}function getQuickRatio(e,t=!1){const n=document.querySelectorAll("#top-ratios li");let o=null,r=!0;for(let a=0;a<n.length;++a){const l=n[a];if(l?.getElementsByClassName("name")?.[0]?.innerText===e){o=t?l?.getElementsByClassName("value")?.[0]?.innerText:l?.getElementsByClassName("value")?.[0]?.innerText?.match(/[\d,.]+/)[0]?.replace(/,/g,""),r=!1;break}}return{notFound:r,value:t?o:parseFloat(o)||0}}function injectStyles(){if(document.getElementById("growth-popover-style"))return;const e=document.createElement("style");e.id="growth-popover-style",e.textContent="\n    .highlight-popover {\n      outline: 1px solid #ffc107;\n      background: #333 !important;\n      z-index: 10;\n    }\n  ",document.head.appendChild(e)}function showAlert(e){alert(e)}function checkIfTTMColumn(e){const t=e[e.length-1];return"ttm"===t?.textContent.trim().toLowerCase()}function getSelectedRows(e,t){return Array.from(e.querySelectorAll("tbody tr")).filter((e=>{const n=e.cells[0]?.textContent.trim();return n&&t.some((e=>n.toLowerCase().startsWith(e.toLowerCase())))}))}function transferRowsToCashFlow(e,t,n,o){e.forEach((e=>{const r=o.insertRow(0),a=e.cells[0]?.textContent.trim();r.insertCell().textContent=a,e.querySelectorAll("td").forEach(((e,o)=>{if(o>0){const a=t[o]?.textContent.trim().toLowerCase();if(-1!==n.indexOf(a)){r.insertCell().textContent=e.textContent.trim()}}}))}))}function createPopover(e,t){const n=document.createElement("div");return n.className="growth-popover",n.textContent=e,Object.assign(n.style,{position:"absolute",background:t>=0?"#2e7d32":"#c62828",color:"#fff",fontSize:"12px",padding:"2px 4px",borderRadius:"4px",top:"-10px",right:"2px",pointerEvents:"auto"}),n}function removeExistingPopover(e){const t=e.querySelector(".growth-popover");t&&t.remove()}function addCheckboxesToHeaders(e){e.forEach(((t,n)=>{const o=n===e?.length-1;if(n>0&&!t.querySelector('input[type="checkbox"]')){const e=document.createElement("input");e.type="checkbox",o&&(e.checked=!0),e.style.marginRight="5px",e.style.cursor="pointer",e.style.transform="scale(1.25)",t.prepend(e)}}))}function addSumButton(e,t,n){const o=getContainerButton("Cash Flow Insights");o.addEventListener("click",(()=>sumSelectedColumns(e,t))),n.parentElement.insertBefore(o,n)}function getContainerButton(e){const t=document.createElement("button");return Object.assign(t,{textContent:e}),Object.assign(t.style,{marginBottom:"10px",marginTop:"10px",padding:"8px 12px",background:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",float:"right"}),t}function waitForChild(e,t,n=5e3){return new Promise(((o,r)=>{if(!e)return r(new Error("Parent element not found"));const a=t(e);if(a)return o(a);const l=new MutationObserver((()=>{const n=t(e);n&&(l.disconnect(),clearTimeout(i),o(n))}));l.observe(e,{childList:!0,subtree:!0});const i=setTimeout((()=>{l.disconnect(),r(new Error("Element not found within timeout"))}),n)}))}window.launchScreenerEnhancement=function(){if(window.calculationsApplied)return void alert("Calculations have already been applied.");injectStyles();const e=["Revenue","Sales","Operating Profit","Financing Profit","Net Profit"],t=document.getElementById("profit-loss");if(!t)return showAlert('Table with id "profit-loss" not found.');const n=t.querySelectorAll("thead th"),o=checkIfTTMColumn(n),r=getSelectedRows(t,e).reverse(),a=document.getElementById("cash-flow");if(!a)return showAlert('Table with id "cash-flow" not found.');const l=a.querySelectorAll("thead th"),i=Array.from(l).map((e=>e.textContent.trim().toLowerCase())),s=a.querySelector("tbody");transferRowsToCashFlow(r,n,i,s),addGrowthPopovers(r,o),addCheckboxesToHeaders(l),addSumButton(l,s,a);const d=document.getElementById("quarters");if(!d)return showAlert('Table with id "quarters" not found.');const c=getSelectedRows(d,e).reverse(),u=d.textContent?.includes("Half Yearly Results");window.growthMode="qoq",addGrowthPopovers(c,o);const{value:p,notFound:m}=getQuickRatio("Pledged percentage");if(document.querySelector("#shareholding")){const e=getLatestValueFromTable("#shareholding","Promoter"),t=createSectionInfoLabel(),n=(p/100*e).toFixed(2);t.textContent=m?"Pledged percentage quick ratio not available!":`Pledged: ${p}% (${n}% / ${e}%)`,document.querySelector("#quarterly-shp")?.parentElement?.insertBefore(t,document.querySelector("#quarterly-shp"))}const{value:h,notFound:g}=getQuickRatio("Cont Liab",!0),f=createSectionInfoLabel();f.style.marginRight="24px",document.querySelector("#balance-sheet table")&&(f.textContent=g?"Contingent liabilities quick ratio not available!":`Contingent liabilities: ${h}`,document.querySelector("#balance-sheet table")?.parentElement?.insertBefore(f,document.querySelector("#balance-sheet table")));const v=getContainerButton("Viewing QoQ");v.addEventListener("click",(()=>{window.growthMode="qoq"===window.growthMode?"yoy":"qoq",v.textContent="qoq"===window.growthMode?"Viewing QoQ":"Viewing YoY","qoq"===window.growthMode?addGrowthPopovers(c,o):addYoYGrowthPopovers(c,u)})),d.parentElement.insertBefore(v,d),addMoreRatiosToTable(),createDrawerWithLayoutToggle();const b=parseFloat(getLatestValueFromTable("#profit-loss","Sales")??getLatestValueFromTable("#profit-loss","Revenue")),x=parseFloat(getLatestValueFromTable("#profit-loss","OPM %")??getLatestValueFromTable("#profit-loss","Financing Margin %")),y=parseFloat(getLatestValueFromTable("#profit-loss","Depreciation"))+parseFloat(getLatestValueFromTable("#profit-loss","Interest")),C=getLatestValueFromTable("#balance-sheet","Equity Capital"),w=getLatestValueFromTable("#balance-sheet","Reserves"),E=parseFloat(C)+parseFloat(w),{value:F}=getQuickRatio("Market Cap"),{value:T}=getQuickRatio("Stock P/E"),{value:B}=getQuickRatio("EVEBITDA"),$=getContainerButton("Financial modelling");$.addEventListener("click",(()=>{showFinancialModelModal(b,F,x,E,y,T,B)})),t.parentElement.insertBefore($,t),window.calculationsApplied=!0};const getTableCellWithText=(e,t,n)=>Array.from(e.querySelectorAll(t)).find((e=>e.textContent.includes(n))),expandCellAndWaitForContent=async(e,t,n)=>{const o="td:nth-child(1)",r=document.querySelector(e);if(!getTableCellWithText(r,o,n)){const e=getTableCellWithText(r,o,t);e?.querySelector("button").click(),await waitForChild(r,(e=>getTableCellWithText(e,o,n)),2e3).catch(console.error)}};async function sumSelectedColumns(e,t){const n=[],o=[];if(e.forEach(((e,t)=>{if(t>0){const r=e.querySelector('input[type="checkbox"]');r?.checked&&(n.push(t),o.push(e.textContent.trim()))}})),0===n.length)return showAlert("No headers selected!");await expandCellAndWaitForContent("#cash-flow","Cash from Operating Activity","Receivables"),await expandCellAndWaitForContent("#cash-flow","Cash from Investing Activity","Fixed assets purchased");const r=["Sales","Revenue","Operating Profit","Financing Profit","Net Profit","Receivables","Payables","Inventory","Other WC items","Cash from Operating Activity","Fixed assets purchased","Fixed assets sold"],a=[];if(t.querySelectorAll("tr").forEach((e=>{const t=e.cells[0]?.textContent.trim()?.replace(/[+-]/g,"");if(r.some((e=>t.toLowerCase().startsWith(e.toLowerCase())))){const o=n.reduce(((t,n)=>{const o=parseFloat(e.cells[n]?.textContent.replace(/[^0-9.-]+/g,"")||"0");return isNaN(o)?t:t+o}),0);a.push({label:t,total:o.toFixed(2)})}})),0===a.length)return showAlert("No matching rows found.");a.sort(((e,t)=>r.findIndex((t=>e.label.toLowerCase().startsWith(t.toLowerCase())))-r.findIndex((e=>t.label.toLowerCase().startsWith(e.toLowerCase())))));const l=a.find((e=>e.label.startsWith("Operating Profit")))||a.find((e=>e.label.startsWith("Financing Profit"))),i=a.find((e=>e.label.startsWith("Net Profit"))),s=a.find((e=>e.label.startsWith("Cash from Operating Activity"))),d=a.find((e=>e.label.startsWith("Fixed assets purchased"))),c=a.find((e=>e.label.startsWith("Fixed assets sold")));d&&(a.push({label:"Net Fixed assets purchased",total:(parseFloat(d?.total??0)+parseFloat(c?.total??0))?.toFixed(2)}),a.push({label:"Free cash flow",total:(parseFloat(s.total)+parseFloat(d?.total??0)+parseFloat(c?.total??0))?.toFixed(2)})),s&&i&&a.push({label:"CFO/PAT",total:(s.total/i.total*100)?.toFixed(2)+" %"}),s&&l&&a.push({label:"CFO/EBITDA",total:(s.total/l.total*100).toFixed(2)+" %"});const u=["Fixed assets purchased","Fixed assets sold"],p=`<div style="margin-bottom: 32px">${o.join(", ")}</div>`,m=a?.filter((e=>!u.some((t=>e.label.startsWith(t))))).map(((e,t)=>{const n=e.label?.startsWith("Cash from Operating Activity")||e.label?.startsWith("Net Profit");return`\n        <div style="font-weight: ${n?"600":""}; padding: 8px 4px; background: ${t%2==0?"rgb(248,248,255)":""}">${e.label}</div>\n        <div style="font-weight: ${n?"600":""}; text-align: right; padding: 8px 4px; background: ${t%2==0?"rgb(248,248,255)":""}">${e.total}</div>\n      `})).join("");createModal({title:"Cash flow insights",content:p+`<div style="display: grid; grid-template-columns: 1fr auto;">${m}</div>`,isHTML:!0})}function createModal({title:e="Modal Title",content:t="",isHTML:n=!1,maxWidth:o="400px"}){const r=document.createElement("div");Object.assign(r.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const a=document.createElement("div");Object.assign(a.style,{backgroundColor:"#fff",padding:"20px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)",maxWidth:o,width:"100%",position:"relative"});const l=document.createElement("h3");l.textContent=e;const i=document.createElement("div");n?i.innerHTML=t:i.textContent=t;const s=document.createElement("button");return s.textContent="×",Object.assign(s.style,{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"32px",cursor:"pointer"}),s.onclick=()=>document.body.removeChild(r),a.append(s,l,i),r.appendChild(a),document.body.appendChild(r),r}function addGrowthPopovers(e){clearPopovers(e),e.forEach((e=>{const t=Array.from(e.cells).map((e=>parseFloat(e.textContent.replace(/[^0-9.-]+/g,""))));for(let n=2;n<t.length;n++){const o=t[n-1],r=t[n];if(isNaN(o)||isNaN(r)||0===o)continue;const a=(r-o)/Math.abs(o)*100,l=e.cells[n],i=createPopover(`${a.toFixed(2)}%`,a);removeExistingPopover(l),l.style.position="relative",l.appendChild(i)}}))}function highlightPopover(e,t){const n=document.getElementById(e);n&&n.classList.toggle("highlight-popover",t)}function addYoYGrowthPopovers(e,t){clearPopovers(e);const n=t?3:5,o=t?2:4;e.forEach(((e,t)=>{const r=Array.from(e.cells).map((e=>parseFloat(e.textContent.replace(/[^0-9.-]+/g,""))));for(let a=n;a<r.length;a++){const n=a-o,l=r[n],i=r[a];if(isNaN(l)||isNaN(i)||0===l)continue;const s=(i-l)/Math.abs(l)*100,d=e.cells[a],c=createPopover(`${s.toFixed(2)}%`,s),u=`popover-${t}-${a}`,p=`popover-${t}-${n}`;c.id=u,c.addEventListener("mouseenter",(()=>{highlightPopover(u,!0),highlightPopover(p,!0)})),c.addEventListener("mouseleave",(()=>{highlightPopover(u,!1),highlightPopover(p,!1)})),removeExistingPopover(d),d.style.position="relative",d.appendChild(c)}}))}function clearPopovers(e){e.forEach((e=>{Array.from(e.cells).forEach((e=>{e.querySelectorAll(".growth-popover").forEach((e=>e.remove()))}))}))}async function addMoreRatiosToTable(){await expandCellAndWaitForContent("#balance-sheet","Other Assets","Trade receivables");const e=document.querySelector("#balance-sheet"),t=document.querySelector("#ratios"),n=document.querySelector("#profit-loss"),o=document.querySelector("#cash-flow");if(!e||!t)return void console.error("Sections not found!");const r=R(e),a=R(t),l=R(n),i=R(o),s=L("Borrowing",e),d=L("Equity Capital",e),c=L("Reserves",e),u=L("Trade receivables",e),p=L("Sales",n),m=L("Net Profit",n),h=L("Profit before tax",n),g=L("Interest",n),f=p?.length?p:L("Revenue",n),v=L("Operating Profit",n),b=L("Cash Equivalents",e),x=L("Tax %",n),y=L("Cash from Operating Activity",o);if(!(s.length&&d.length&&c.length))return void console.error("Required rows not found or empty!");const C=q(l,f),w=q(r,u),E=function(e,t,n,o){const r={};return e.slice(1).forEach(((e,a)=>{const l=t[a],i=(n[a]??0)+(o[a]??0);r[e]={ratioValue:i&&null!=l?(l/i).toFixed(2):null,numerator:l,denominator:i}})),r}(r,s,d,c),F=function(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=t[r],l=n[e]??0;o[e]={ratioValue:l?(a/l).toFixed(2):0===a?"0.00":null,numerator:a,denominator:l}})),o}(r,u,C),T=function(e,t,n){const o={};return e.slice(1).forEach((e=>{const r=t[e]??0,a=n[e]??0;o[e]=`${r.toFixed(0)}% / ${a.toFixed(0)}%`})),o}(r,k(r,w),k(l,C)),B=function(e,t,n,o,r,a,l){const i={};return e.slice(1).forEach(((e,s)=>{const d=(t[s]??0)+(n[s]??0)+(o[s]??0)-(r[s]??0),c=(a[s]??0)*(1-(l?.[s]??0)/100);if(0===d||isNaN(d))return void(i[e]={ratioValue:"-",numerator:null,denominator:null});const u=c/d*100;i[e]={ratioValue:u?.toFixed(1)+"%",numerator:parseFloat(c?.toFixed(1)),denominator:parseFloat(d?.toFixed(1))}})),i}(r,d,c,s,b,v,x),$=function(e,t,n,o,r,a,l){const i={},s=[],d=[];return e.slice(1).forEach(((e,i)=>{const c=(t[i]??0)+(n[i]??0)+(o[i]??0)-(r[i]??0),u=(a[i]??0)*(1-(l?.[i]??0)/100);s.push(u),d.push(c)})),e.slice(1).forEach(((e,t)=>{if(0===t||!isFinite(d[t])||!isFinite(d[t-1]))return void(i[e]={ratioValue:"-",numerator:null,denominator:null});const n=s[t]-s[t-1],o=d[t]-d[t-1];if(0===o||!isFinite(o))return void(i[e]={ratioValue:"-",numerator:null,denominator:null});const r=n/o*100;i[e]={ratioValue:r.toFixed(1)+"%",numerator:parseFloat(n.toFixed(1)),denominator:parseFloat(o.toFixed(1))}})),i}(r,d,c,s,b,v,x),I=function(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=n[r],l=(t[r]??0)+(a??0);o[e]={ratioValue:l?(l/a).toFixed(2):0===a?"0.00":null,numerator:l,denominator:a}})),o}(l,h,g),A=P(i,y,m),S=P(i,y,v),M=t.querySelector("tbody");if(!W(M,"ROE")){const e=function(e,t,n,o){const r={};return e.slice(1).forEach(((e,a)=>{const l=(t[a]??0)+(n[a]??0),i=0!==l?(o?.[a]??0)/l*100:0;r[e]=`${i.toFixed(1)}%`})),r}(r,d,c,m);O(M,a,"ROE",e)}if(!W(M,"ROCE")){const e=function(e,t,n,o,r,a){const l={};return e.slice(1).forEach(((e,i)=>{const s=(t[i]??0)+(n[i]??0),d=o[i]??0,c=(t[i-1]??null)+(n[i-1]??null),u=o[i-1]??null;if(!(null!=t[i-1]||null!=n[i-1]||null!=o[i-1]))return void(l[e]="-");const p=(s+d+c+u)/2,m=r[i]??0,h=a[i]??0,g=0!==p?(m+h)/p*100:0;l[e]=g.toFixed(1)+"%"})),l}(r,d,c,s,h,g);O(M,a,"ROCE",e)}function R(e){return Array.from(e.querySelectorAll("thead th")).map((e=>e.innerText.trim())).filter((e=>!e.includes("(")))}function L(e,t){const n=t.querySelectorAll("tbody tr");for(let t of n){const n=t.querySelector("td.text")?.innerText?.trim();if(n?.startsWith(e))return Array.from(t.querySelectorAll("td:not(.text)")).map((e=>{const t=parseFloat(e.innerText.replace(/[,|%]/g,""));return isNaN(t)?null:t}))}return[]}function q(e,t){const n={};return e.slice(1).forEach(((e,o)=>{n[e]=t?.[o]??0})),n}function P(e,t,n){const o={};return e.slice(1).forEach(((e,r)=>{const a=t[r]??0,l=n[r]??0,i=0!==l?(a/l*100).toFixed(2)+"%":"-";o[e]={ratioValue:i,numerator:a,denominator:l}})),o}function k(e,t){const n={};let o=null;return e.slice(1).forEach((e=>{const r=t[e];if(null!=o&&null!=r&&0!==o){let t=(r-o)/Math.abs(o)*100;isFinite(t)&&!isNaN(t)||(t=0),n[e]=t}else n[e]=0;o=r})),n}function N(e,t,n,o,r,a=!0){const l=document.createElement("tr");l.className=a?"stripe":"";const i=document.createElement("td");i.className="text",i.innerText=n,l.appendChild(i),t.slice(1).forEach((e=>{const t=document.createElement("td"),n=o[e],a=n?.ratioValue,i=n?.numerator,s=n?.denominator;let d="-",c="";null!==a&&(d=a,c=null!=i&&null!=s?`${r}: ${i?.toFixed(2)}/${s?.toFixed(2)}`:""),c?t.setAttribute("data-tooltip",c):t.removeAttribute("data-tooltip"),t.innerText=d,l.appendChild(t)})),e.appendChild(l)}function O(e,t,n,o,r=!0){const a=document.createElement("tr");a.className=r?"stripe":"";const l=document.createElement("td");l.className="text",l.innerText=n,a.appendChild(l),t.slice(1).forEach((e=>{const t=document.createElement("td");t.innerText=o[e]??"-",a.appendChild(t)})),e.appendChild(a)}function W(e,t){return Array.from(e.querySelectorAll("tr")).some((e=>e.querySelector("td.text")?.innerText.trim()?.startsWith(t)))}N(M,a,"Debt to Equity",E,"D/E"),N(M,a,"Interest coverage",I,"IC"),N(M,a,"Receivables to Sales",F,"R/S",!1),O(M,a,"Receivables / Sales Growth",T,!1),N(M,a,"ROIC",B,"ROIC"),N(M,a,"ROIIC",$,"ROIIC"),N(M,a,"CFO/PAT",A,"CFO/PAT %",!1),N(M,a,"CFO/EBITDA",S,"CFO/EBITDA %",!1)}function createDrawerWithLayoutToggle(){window.setDrawerContent=function(e){const t=document.querySelector("#drawer-content");t&&("string"==typeof e?t.innerHTML+=e:e instanceof HTMLElement&&t.appendChild(e))};let e=!1;const t=document.createElement("div");t.id="drawer";const n=document.createElement("div");n.id="drawer-handle",n.innerText="≡";const o=document.createElement("div");o.id="drawer-content",o.style.overflowY="auto",o.style.maxHeight="100vh";const r=document.createElement("button");r.id="layout-toggle-btn",r.textContent="Fix",r.style.fontWeight="normal",r.style.height="32px",r.style.padding="4px",r.addEventListener("click",(()=>{const e=t.classList.toggle("expanded");l.classList.toggle("shifted",e)}));const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="space-between",a.innerHTML='<h2 style="margin-top: 0;">Financials checklist</h2>',a.appendChild(r),o.innerHTML="",o.appendChild(a),t.appendChild(n),t.appendChild(o);const l=document.createElement("div");for(l.id="page-wrapper";document.body.firstChild;)l.appendChild(document.body.firstChild);document.body.appendChild(t),document.body.appendChild(l);const i=document.createElement("style");i.textContent="\n        body {\n          margin: 0;\n          padding: 0;\n        }\n    \n        #drawer {\n          position: fixed;\n          top: 0;\n          left: -20%;\n          width: 20%;\n          height: 100%;\n          background: white;\n          box-shadow: 2px 0 4px rgba(0,0,0,0.2);\n          transition: left 0.3s ease, width 0.3s ease;\n          z-index: 9999;\n          font-family: sans-serif;\n        }\n    \n        #drawer.open {\n          left: 0;\n        }\n    \n        #drawer.expanded {\n          width: 20%;\n        }\n    \n        #drawer-handle {\n          position: absolute;\n          right: -30px;\n          top: 50%;\n          transform: translateY(-50%);\n          width: 30px;\n          height: 60px;\n          background: white;\n          font-size: 20px;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 0 5px 5px 0;\n          box-shadow: 3px 0 4px rgba(0,0,0,0.2);\n        }\n    \n        #drawer-content {\n          padding: 20px;\n        }\n    \n        #page-wrapper {\n          transition: margin-left 0.3s ease, width 0.3s ease;\n        }\n    \n        #page-wrapper.shifted {\n          margin-left: 20%;\n          width: 80%;\n        }\n      ",document.head.appendChild(i),n.addEventListener("click",(()=>{const n=!t.classList.contains("open");var o;(t.classList.toggle("open"),window.guideInfoLoaded)||(n?(o="https://cdn.jsdelivr.net/gh/gitdev-common/utils@1.0.11/screener-guide.js",new Promise(((t,n)=>{if(e)return t();const r=document.createElement("script");r.src=o,r.onload=()=>{e=!0,t()},r.onerror=n,document.head.appendChild(r)}))).then((()=>{window.guideInfoLoaded=!0})).catch((e=>{console.error("Failed to load drawer script:",e)})):(t.classList.remove("expanded"),l.classList.remove("shifted")))}))}function showFinancialModelModal(e,t,n,o,r=30,a=20,l=15){function i(e,t){const n=e/100;return Math.pow(1+n,t)}createModal({title:"Financial Modelling (Bull / Base / Bear)",content:getFinancialModelHTML(e,t,o),isHTML:!0,maxWidth:"1000px"}),setTimeout((()=>{const e=document.getElementById("valuation-method"),t=document.getElementById("scenario-table");function o(e){const o=["Bull","Base","Bear"].map((t=>{const o="Bull"===t?25:"Base"===t?20:15,i="Base"===t?n:"Bull"===t?n+2:n-2,s="Base"===t?r:"Bull"===t?(.9*r).toFixed(1):(1.1*r).toFixed(1),d="Base"===t?parseInt(a):"Bull"===t?parseInt(.8*a):parseInt(1.2*a),c="Base"===t?parseInt(l):"Bull"===t?parseInt(.8*l):parseInt(1.2*l),u='<svg\n                xmlns="http://www.w3.org/2000/svg"\n                width="16"\n                height="16"\n                fill="currentColor"\n                viewBox="0 0 16 16">\n                <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zM4 2.5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zM4.5 6.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V7a.5.5 0 0 0-.5-.5h-1zM7.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-1zM10.5 6.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z" />\n              </svg>';return"pe"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                    <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-rev" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-rev',\n                          document.getElementById('rev').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                  </td>\n                  <td><input type="number" id="${t}-ebitda" value="${i}"></td>\n                  <td><input type="number" id="${t}-other" value="${s}"></td>\n                  <td><input type="number" id="${t}-tax" value="26"></td>\n                  <td><input type="number" id="${t}-pe" value="${d}"></td>\n                </tr>`:"ev_ebitda"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                  <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-rev" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-rev',\n                          document.getElementById('rev').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                    </td>\n                  <td><input type="number" id="${t}-ebitda" value="${i}"></td>\n                  <td><input type="number" id="${t}-evEbitda" value="${c}"></td>\n                </tr>`:"pb"===e?`\n                <tr>\n                  <td>${t}</td>\n                  <td>\n                  <div style="display: flex; align-items: center;">\n                      <input type="number" id="${t}-rev" value="${o}">\n                      <div style="display: flex; align-items: center; margin-left: 8px; cursor: pointer;" onclick="openCAGRCalculator(\n                        '${t}-rev',\n                          document.getElementById('networth').value,\n                          document.getElementById('years').value\n                      )">\n                        ${u}\n                      </div>\n                    </div>\n                  </td>\n                  <td><input type="number" id="${t}-pb" value="${"Bull"===t?6:"Base"===t?4:2}"></td>\n                </tr>`:null})).join("");let i="";i="pe"===e?"\n            <tr>\n              <th>Scenario</th>\n              <th>Rev CAGR %</th>\n              <th>EBITDA Margin %</th>\n              <th>Other Costs</th>\n              <th>Tax Rate %</th>\n              <th>Exit PE</th>\n            </tr>":"ev_ebitda"===e?"\n            <tr>\n              <th>Scenario</th>\n              <th>Rev CAGR %</th>\n              <th>EBITDA Margin %</th>\n              <th>Exit EV / EBITDA</th>\n            </tr>":"\n            <tr>\n              <th>Scenario</th>\n              <th>Net Worth CAGR %</th>\n              <th>Exit P/B</th>\n            </tr>",t.innerHTML=`\n          <table>\n            <thead>${i}</thead>\n            <tbody>${o}</tbody>\n          </table>\n        `}o("pe"),e.addEventListener("change",(()=>{o(e.value)})),document.getElementById("calculate-btn")?.addEventListener("click",(()=>{const e=parseFloat(document.getElementById("rev").value),t=parseFloat(document.getElementById("mcap").value),n=parseInt(document.getElementById("years").value),o=document.getElementById("networth").value,r=document.getElementById("valuation-method").value,a=[];for(const l of["Bull","Base","Bear"]){let s=0;if("pe"===r){const o=parseFloat(document.getElementById(`${l}-rev`).value)/100,r=parseFloat(document.getElementById(`${l}-ebitda`).value)/100,d=parseFloat(document.getElementById(`${l}-other`).value),c=parseFloat(document.getElementById(`${l}-tax`).value)/100,u=parseFloat(document.getElementById(`${l}-pe`).value),p=e*Math.pow(1+o,n),m=(p*r-d)*(1-c);s=m*u;const h=100*(Math.pow(s/t,1/n)-1);a.push({scenario:l,futureRevenue:p.toFixed(0),futurePAT:m.toFixed(0),futureMCap:s.toFixed(0),cagr:`${h.toFixed(2)} % (${i(h,n).toFixed(1)}x)`})}else if("ev_ebitda"===r){const o=parseFloat(document.getElementById(`${l}-rev`).value)/100,r=parseFloat(document.getElementById(`${l}-ebitda`).value)/100,d=parseFloat(document.getElementById(`${l}-evEbitda`).value),c=e*Math.pow(1+o,n),u=c*r;s=u*d;const p=100*(Math.pow(s/t,1/n)-1);a.push({scenario:l,futureRevenue:c.toFixed(0),futureEBITDA:u.toFixed(0),futureMCap:s.toFixed(0),cagr:`${p.toFixed(2)} % (${i(p,n).toFixed(1)}x)`})}else if("pb"===r){const e=parseFloat(document.getElementById(`${l}-networthGrowth`).value)/100,r=parseFloat(document.getElementById(`${l}-pb`).value),d=o*Math.pow(1+e,n);s=d*r;const c=100*(Math.pow(s/t,1/n)-1);a.push({scenario:l,futureNetWorth:d.toFixed(0),futureMCap:s.toFixed(0),cagr:`${c.toFixed(2)} % (${i(c,n).toFixed(1)}x)`})}}const l="pe"===r?["Future Revenue","Future PAT"]:"ev_ebitda"===r?["Future Revenue","Future EBITDA"]:["Future Net Worth"];document.getElementById("results").innerHTML=`\n          <h4>Results</h4>\n          <table style="width:100%; border-collapse: collapse; font-size: 1.4rem; margin-top: 1rem">\n            <thead>\n              <tr>\n                <th>Scenario</th>\n                ${l.map((e=>`<th>${e}</th>`)).join("")}\n                <th>Future MCap</th>\n                <th>Expected CAGR</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${a.map((e=>`\n                  <tr>\n                    <td>${e.scenario}</td>\n                    ${l.map((t=>t.includes("Revenue")?`<td>${e.futureRevenue}</td>`:t.includes("PAT")?`<td>${e.futurePAT}</td>`:t.includes("EBITDA")?`<td>${e.futureEBITDA}</td>`:t.includes("Net Worth")?`<td>${e.futureNetWorth}</td>`:"")).join("")}\n                    <td>${e.futureMCap}</td>\n                    <td>${e.cagr}</td>\n                  </tr>`)).join("")}\n            </tbody>\n          </table>`}))}),0)}function getFinancialModelHTML(e,t,n=0){return`\n      <div class="financial-model-content">\n        <style>\n          .financial-model-content .input-group {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 1rem;\n            margin-bottom: 2rem;\n            margin-top: 3rem;\n          }\n          .financial-model-content .input-group > div {\n            flex: 1;\n            min-width: 150px;\n          }\n          .financial-model-content input,\n          .financial-model-content select {\n            width: 100%;\n            padding: 0.4rem;\n            font-size: 1.5rem;\n            height: 34px;\n          }\n          .financial-model-content label {\n            font-size: 1.5rem;\n            display: block;\n            margin-bottom: 0.3rem;\n          }\n          .financial-model-content table,\n          .financial-model-content th,\n          .financial-model-content td {\n            border: 1px solid #ccc;\n            padding: 8px;\n            text-align: center;\n          }\n          .financial-model-content th {\n            background-color: #f0f0f5;\n          }\n          .financial-model-content table {\n            width: 100%;\n            border-collapse: collapse;\n          }\n          .financial-model-content #calculate-btn {\n            margin-top: 1rem;\n            padding: 0.6rem 1.2rem;\n            background-color: rgb(25, 118, 210);\n            color: white;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n            border-radius: 4px;\n          }\n        </style>\n\n        <div class="input-group">\n          <div>\n            <label>Current MCap:</label>\n            <input type="number" id="mcap" value="${t}">\n          </div>\n          <div>\n            <label>Current Revenue:</label>\n            <input type="number" id="rev" value="${e}">\n          </div>\n          <div>\n            <label>Current Net Worth:</label>\n            <input type="number" id="networth" value="${n}">\n          </div>\n          <div>\n            <label>Years:</label>\n            <input type="number" id="years" value="3">\n          </div>\n          <div>\n            <label>Valuation Method:</label>\n            <select id="valuation-method">\n              <option value="pe">P/E</option>\n              <option value="ev_ebitda">EV/EBITDA</option>\n              <option value="pb">P/B</option>\n            </select>\n          </div>\n        </div>\n\n        <div id="scenario-table"></div>\n\n        <div style="text-align:right">\n          <button id="calculate-btn">Calculate</button>\n        </div>\n        <div id="results"></div>\n      </div>\n    `}function openCAGRCalculator(e,t,n){const o=createModal({title:"CAGR Calculator",content:`\n      <style>\n        #cagr-popup-content {\n          font-size: 1.4rem;\n        }\n        #cagr-popup-content label {\n          display: block;\n          margin-bottom: 1rem;\n        }\n        #cagr-popup-content input {\n          width: 100%;\n          padding: 0.5rem;\n          font-size: 1.4rem;\n          box-sizing: border-box;\n        }\n        #cagr-popup-content .button-row {\n          display: flex;\n          justify-content: flex-end;\n          gap: 1rem;\n          margin-top: 1rem;\n        }\n        #cagr-popup-content button {\n          padding: 0.6rem 1.2rem;\n          font-size: 1.4rem;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n        }\n        #calc-cagr-btn {\n          background-color: #1976d2;\n          color: white;\n        }\n        #close-cagr-btn {\n          background-color: #e0e0e0;\n          color: black;\n        }\n        #cagr-popup-content .error {\n          color: red;\n          font-size: 1.3rem;\n          margin-top: 0.5rem;\n        }\n        #cagr-popup-content .result {\n          margin-top: 1rem;\n          font-weight: bold;\n          font-size: 1.4rem;\n        }\n      </style>\n      <div id="cagr-popup-content">\n        <label>\n          Start Value:\n          <input type="number" id="cagr-start" value="${t}" />\n        </label>\n        <label>\n          End Value:\n          <input type="number" id="cagr-end" />\n        </label>\n        <label>\n          Years:\n          <input type="number" id="cagr-years" value="${n}" />\n        </label>\n\n        <div class="button-row" style="margin-top: 24px;">\n          <button id="close-cagr-btn">Close</button>\n          <button id="calc-cagr-btn">Calculate</button>\n        </div>\n\n        <p id="cagr-error" class="error"></p>\n        <p id="cagr-result" class="result"> </p>\n      </div>\n    `,isHTML:!0,onClose:()=>{}});setTimeout((()=>{document.getElementById("calc-cagr-btn").onclick=()=>{const t=parseFloat(document.getElementById("cagr-start").value),n=parseFloat(document.getElementById("cagr-end").value),o=parseFloat(document.getElementById("cagr-years").value),r=document.getElementById("cagr-error"),a=document.getElementById("cagr-result");if(r.textContent="",a.textContent="",!t||!n||!o||t<=0||o<=0)return void(r.textContent="Please enter valid positive numbers.");const l=100*(Math.pow(n/t,1/o)-1);a.textContent=`CAGR: ${l.toFixed(2)}%`;const i=document.getElementById(e);i&&(i.value=l.toFixed(2))},document.getElementById("close-cagr-btn").onclick=()=>{document.body.removeChild(o)}}),0)}
