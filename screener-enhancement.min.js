function showAlert(t){alert(t)}function checkIfTTMColumn(t){const e=t[t.length-1];return"ttm"===e?.textContent.trim().toLowerCase()}function getSelectedRows(t,e){return Array.from(t.querySelectorAll("tbody tr")).filter((t=>{const o=t.cells[0]?.textContent.trim();return o&&e.some((t=>o.toLowerCase().startsWith(t.toLowerCase())))}))}function transferRowsToCashFlow(t,e,o,n){t.forEach((t=>{const r=n.insertRow(0),i=t.cells[0]?.textContent.trim();r.insertCell().textContent=i,t.querySelectorAll("td").forEach(((t,n)=>{if(n>0){const i=e[n]?.textContent.trim().toLowerCase();if(-1!==o.indexOf(i)){r.insertCell().textContent=t.textContent.trim()}}}))}))}function createPopover(t,e){const o=document.createElement("div");return o.className="growth-popover",o.textContent=t,Object.assign(o.style,{position:"absolute",background:e>=0?"#2e7d32":"#c62828",color:"#fff",fontSize:"12px",padding:"2px 4px",borderRadius:"4px",top:"-10px",right:"0px",pointerEvents:"none"}),o}function removeExistingPopover(t){const e=t.querySelector(".growth-popover");e&&e.remove()}function addCheckboxesToHeaders(t){t.forEach(((t,e)=>{if(e>0&&!t.querySelector('input[type="checkbox"]')){const e=document.createElement("input");e.type="checkbox",e.style.marginRight="5px",t.prepend(e)}}))}function addSumButton(t,e,o){const n=getContainerButton("Sum Selected Columns");n.addEventListener("click",(()=>sumSelectedColumns(t,e))),o.parentElement.insertBefore(n,o)}function getContainerButton(t){const e=document.createElement("button");return Object.assign(e,{textContent:t}),Object.assign(e.style,{marginBottom:"10px",marginTop:"10px",padding:"8px 12px",background:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",float:"right"}),e}function sumSelectedColumns(t,e){const o=["Sales","Revenue","Operating Profit","Financing Profit","Net Profit","Cash from Operating Activity"],n=[],r=[];if(t.forEach(((t,e)=>{if(e>0){const o=t.querySelector('input[type="checkbox"]');o?.checked&&(n.push(e),r.push(t.textContent.trim()))}})),0===n.length)return showAlert("No headers selected!");const i=[];if(e.querySelectorAll("tr").forEach((t=>{const e=t.cells[0]?.textContent.trim()?.replace("+","");if(o.some((t=>e.toLowerCase().startsWith(t.toLowerCase())))){const o=n.reduce(((e,o)=>{const n=parseFloat(t.cells[o]?.textContent.replace(/[^0-9.-]+/g,"")||"0");return isNaN(n)?e:e+n}),0);i.push({label:e,total:o.toFixed()})}})),0===i.length)return showAlert("No matching rows found.");const a=i.find((t=>t.label.startsWith("Operating Profit")))||i.find((t=>t.label.startsWith("Financing Profit"))),s=i.find((t=>t.label.startsWith("Net Profit"))),l=i.find((t=>t.label.startsWith("Cash from Operating Activity")));l&&s&&i.push({label:"CFO/PAT",total:(l.total/s.total*100).toFixed(2)+" %"}),l&&a&&i.push({label:"CFO/EBITDA",total:(l.total/a.total*100).toFixed(2)+" %"});createModal({title:"Cash flows",content:`<div style="margin-bottom: 32px">${r.join(", ")}</div>`+`<div style="display: grid; grid-template-columns: 1fr auto; row-gap: 12px">${i.map(((t,e)=>`\n      <div style="font-weight: 500; padding: 4px 2px; background: ${e%2==0?"rgb(248,248,255)":""}">${t.label}</div>\n      <div style="text-align: right; padding: 4px 2px; background: ${e%2==0?"rgb(248,248,255)":""}">${t.total}</div>\n    `)).join("")}</div>`,isHTML:!0})}function createModal({title:t="Modal Title",content:e="",isHTML:o=!1}){const n=document.createElement("div");Object.assign(n.style,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const r=document.createElement("div");Object.assign(r.style,{backgroundColor:"#fff",padding:"20px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)",maxWidth:"400px",width:"100%",position:"relative"});const i=document.createElement("h3");i.textContent=t;const a=document.createElement("div");o?a.innerHTML=e:a.textContent=e;const s=document.createElement("button");s.textContent="Ã—",Object.assign(s.style,{position:"absolute",top:"10px",right:"10px",border:"none",background:"transparent",fontSize:"32px",cursor:"pointer"}),s.onclick=()=>document.body.removeChild(n),r.append(s,i,a),n.appendChild(r),document.body.appendChild(n)}function addGrowthPopovers(t){clearPopovers(t),t.forEach((t=>{const e=Array.from(t.cells).map((t=>parseFloat(t.textContent.replace(/[^0-9.-]+/g,""))));for(let o=2;o<e.length;o++){const n=e[o-1],r=e[o];if(isNaN(n)||isNaN(r)||0===n)continue;const i=(r-n)/Math.abs(n)*100,a=t.cells[o],s=createPopover(`${i.toFixed(2)}%`,i);removeExistingPopover(a),a.style.position="relative",a.appendChild(s)}}))}function addYoYGrowthPopovers(t,e){clearPopovers(t);const o=e?3:5,n=e?2:4;t.forEach((t=>{const e=Array.from(t.cells).map((t=>parseFloat(t.textContent.replace(/[^0-9.-]+/g,""))));for(let r=o;r<e.length;r++){const o=e[r-n],i=e[r];if(isNaN(o)||isNaN(i)||0===o)continue;const a=(i-o)/Math.abs(o)*100,s=t.cells[r],l=createPopover(`${a.toFixed(2)}%`,a);removeExistingPopover(s),s.style.position="relative",s.appendChild(l)}}))}function clearPopovers(t){t.forEach((t=>{Array.from(t.cells).forEach((t=>{t.querySelectorAll(".growth-popover").forEach((t=>t.remove()))}))}))}window.launchScreenerEnhancement=function(){if(window.calculationsApplied)return void alert("Calculations have already been applied.");const t=["Revenue","Sales","Operating Profit","Financing Profit","Net Profit"],e=document.getElementById("profit-loss");if(!e)return showAlert('Table with id "profit-loss" not found.');const o=e.querySelectorAll("thead th"),n=checkIfTTMColumn(o),r=getSelectedRows(e,t).reverse(),i=document.getElementById("cash-flow");if(!i)return showAlert('Table with id "cash-flow" not found.');const a=i.querySelectorAll("thead th"),s=Array.from(a).map((t=>t.textContent.trim().toLowerCase())),l=i.querySelector("tbody");transferRowsToCashFlow(r,o,s,l),addGrowthPopovers(r,n),addCheckboxesToHeaders(a),addSumButton(a,l,i);const c=document.getElementById("quarters");if(!c)return showAlert('Table with id "quarters" not found.');const d=getSelectedRows(c,t).reverse(),p=c.textContent?.includes("Half Yearly Results");window.growthMode="qoq",addGrowthPopovers(d,n);const u=getContainerButton("Viewing QoQ");u.addEventListener("click",(()=>{window.growthMode="qoq"===window.growthMode?"yoy":"qoq",u.textContent="qoq"===window.growthMode?"Viewing QoQ":"Viewing YoY","qoq"===window.growthMode?addGrowthPopovers(d,n):addYoYGrowthPopovers(d,p)})),c.parentElement.insertBefore(u,c),window.calculationsApplied=!0};
